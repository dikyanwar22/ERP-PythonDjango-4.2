{% load static %}
<!DOCTYPE html>
<html lang="en" data-layout="topnav">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <title>ERP Python Django 4.2 LTS</title>

    <!-- font awesome icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- tabler icon  -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">

    <!-- remix icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">

    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'adminto/assets/images/favicon.ico' %}">

    <!-- Vector Maps css -->
    <link href="{% static 'adminto/assets/vendor/jsvectormap/jsvectormap.min.css' %}" rel="stylesheet" type="text/css">

    <!-- Theme Config Js -->
    <script src="{% static 'adminto/assets/js/config.js' %}"></script>

    <!-- Vendor css -->
    <link href="{% static 'adminto/assets/css/vendor.min.css' %}" rel="stylesheet" type="text/css" />

    <!-- App css -->
    <link href="{% static 'adminto/assets/css/app.min.css' %}" rel="stylesheet" type="text/css" id="app-style" />

    <!-- Icons css -->
    <link href="{% static 'adminto/assets/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
    
    <!-- agar ketika mode smartphone tidak ada scroll horizontal -->
    <style>
        @media (min-width: 1024px) {
        /* Menghapus scroll horizontal */
        html, body {
            overflow-x: hidden !important;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        /* Memastikan semua elemen tidak melebihi viewport */
        *, *::before, *::after {
            max-width: 100% !important;
        }

        /* Mencegah elemen flex atau grid melampaui lebar layar */
        body {
            display: flex !important;
        }

        /* Memberi jarak pada modules di sisi kiri dan kanan */
        .spacing-modules {  
            margin-left: 30px !important;
            margin-right: 30px !important;
        }
    }
    </style>

    <!-- setting ukuran icon -->
    <style>
        @media (min-width: 1024px) {
        /* untuk agar icon ditengah dan teks dibawahnya */
        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 2px;
        }
        
        .menu-icon i {
            font-size: 30px !important; /* ukuran icon */
        }
    
        .menu-text {
            font-size: 12px;  /* ukuran teks */
            margin-top: 2px;
        }

        .menu-arrow {
            margin-top: -7px !important; /*untuk membuat icon mendekat keatas */
        }
    }
    </style>
    <!-- setting ukuran icon -->

    <!-- untuk setting agar dropdown tidak terhalang scroll  -->
    <style>
        @media (min-width: 1024px) {
        
        /* untuk membuat scroll horizontal tanpa scroll vertikal */
        .custom-scroll-horizontal {
            position: relative !important;
            overflow-x: auto;
            overflow-y: hidden;
            /* z-index: 1 !important; */
            /* Untuk Firefox */
            scrollbar-width: thin;
            scrollbar-color: #888 #f1f1f1;
        }

        /* Untuk browser berbasis Webkit */
        .custom-scroll-horizontal::-webkit-scrollbar {
            height: 3px; /* Ukuran scrollbar lebih kecil */
        }

        .custom-scroll-horizontal::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scroll-horizontal::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 1.5px;
        }

        /* Dropdown harus bisa keluar dari scroll */
        .dropdown-menu {
            position: fixed !important;  
            /* z-index: 1050 !important;  */
            margin-top: -28px !important;
        }

        /* Menampilkan submenu saat hover pada dropdown */
        .custom-dropdown-submenu {
            position: absolute !important;
        }
    }
    </style>
    <!-- untuk setting agar dropdown tidak terhalang scroll  -->

    <!-- ChatBox -->
    <style type="text/css">
        .chat_box {
          z-index: 9999;
          position: fixed;
          right: 20px;
          bottom: 0px;
          width: 300px;
        }
        .chat_head, .msg_head {
          background: #222222;
          color: white;
          padding: 10px;
          font-weight: bold;
          cursor: pointer;
          border-radius: 5px 5px 0px 0px;
        }
        .searchBox {
          padding: 0 !important;
          margin: 0 !important;
          height: 40px;
          width: 100%;
        }
        .searchBox-inner {
          height: 100%;
          width: 100%;
          padding: 0px !important;
          background-color: #eee;
        }
        .chat_body {
          background: whitesmoke;
          height: 300px;
        }
        .member_list {
          height: 300px;
          overflow-x: hidden;
          overflow-y: auto;
        }
        .msg_box{
          position:fixed;
          bottom:-5px;
          width:300px;
          height:305px;
          background:white;
          border-radius:5px 5px 0px 0px;
        }
        .pull-left {
          float: left!important;
        }
        .img-circle {
          border-radius: 50%;
        }
        </style>
        <!-- ChatBox -->
</head>

<body>

    {% block content %}

    {% endblock %}   

    <!-- chatbox -->
<div class="chat_box">
    <div class="chat_head d-flex align-items-center justify-content-end" style="background: #3c8dbc; padding: 5px 10px; position: relative;">
      <img src="https://cdn-icons-png.flaticon.com/512/1827/1827312.png" style="width:25px; height:25px; margin-right: 0px;">
      <span id="total_help" class="badge bg-danger rounded-circle">0</span>
    </div>
    
    <div class="searchBox" style="display: none;">
      <div class="searchBox-inner" align="center" style="border-right: 1px solid #d0d0d0;border-left: 1px solid #d0d0d0;border-top: 1px solid #d0d0d0;">
        <input type="text" id="myInput1" class="span3" style="margin-top: 6px;width: 90%;" onkeyup="myFunction1()" placeholder="Search Support...">
      </div>
    </div>
    <div class="chat_body" style="display: none;">
      <div class="member_list" style="background: white;border: 1px solid #d0d0d0;">
        <!-- untuk menampilkan data helpdesk -->
          <span id="tampil_helpdesk"></span>
          <!-- untuk menampilkan data helpdesk -->
          </div>
        </div>
</div>
    <!-- chatbox -->

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- chatbox -->
<script type="text/javascript">
    $.ajaxSetup({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      }
    });
    
    show_helpdesk();
    function show_helpdesk() {
      $.ajax({
      url: "",
      method: 'GET',
      dataType: 'JSON',
      success: function(response) {
        var hitung = response.data.length;
        var elemenHTML = '<ul class="list-unstyled" id="style-5">';
        for (var i = 0; i < hitung; i++) {
          elemenHTML += '<li class="left clearfix" style="padding: 10px 10px; border-bottom: 1px solid #d0d0d0; position: relative;">';
          elemenHTML += '<a href="' + response.data[i].url + '" target="_blank" style="display: block;">';
          
          elemenHTML += '<small style="color: #999999; font-size: 10px; position: absolute; top: 5px; right: 10px;">';
          elemenHTML += '<i class="fa fa-clock-o"></i> ' + response.data[i].waktu + '</small>';
    
          elemenHTML += '<div style="display: flex; align-items: center; margin-top: 15px;">';
          elemenHTML += '<img src="' + response.data[i].image + '" class="img-circle" alt="User Image" style="width: 40px; height: 40px; margin-right: 10px;">';
    
          elemenHTML += '<div>';
          elemenHTML += '<h4 style="margin: 0; color: #444444; font-size: 15px;">' + response.data[i].name + '</h4>';
          elemenHTML += '<p style="margin: 0; font-size: 12px; color: #888888;">' + response.data[i].helpdesk + '</p>';
          elemenHTML += '</div>';
    
          elemenHTML += '</div>'; 
          elemenHTML += '</a>';
          elemenHTML += '</li>';
        }
        elemenHTML += '</ul>';
        $('#tampil_helpdesk').html(elemenHTML);
        $('#total_help').text(hitung);
      },
      error: function(xhr, status, error) {
        console.error("AJAX Error: ", error);
      }
    });
    }
    
    function myFunction1() {
      var input, filter, ul, li, a, i;
      input = document.getElementById('myInput1');
      filter = input.value.toUpperCase();
      ul = document.getElementById("style-5");
      li = ul.getElementsByTagName('li');
      for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
          li[i].style.display = "";
        } else {
          li[i].style.display = "none";
        }
      }
    }
    </script>
    <!-- chatbox -->
    
    <!-- chatbox -->
    <script type="text/javascript">
    $('.chat_head').click(function(){
      $('.chat_body').slideToggle('slow');
      $('.searchBox').slideToggle('slow');
      $('.msg_box').hide('slow');
    });
    
    $('.msg_head').click(function(){
      $('.msg_wrap').slideToggle('slow');
    });
    
    $('.msg_box').hide();
    $('.chat_body').hide();
    $('.searchBox').hide();
    </script>
    <!-- chatbox -->

        <!-- menampilkan modul -->
        <script type="text/javascript">
        function tampil_modul() {
        $.ajax({
            url: "{% url 'module_user' %}",
            method: 'GET',
            dataType: 'JSON',
            contentType: "application/json",
            headers: {
              "X-CSRFToken": $("meta[name='csrf-token']").attr("content")
            },
            success: function(response) {
                var elemenHTML = `
                <nav class="page-container">
                    <div class="collapse navbar-collapse custom-scroll-horizontal" id="topnav-menu-content">
                        <ul class="navbar-nav">
                `;
    
                for (var i = 0; i < response.length; i++) {
                    var modul = response[i];
    
                    elemenHTML += `
                        <li class="nav-item dropdown hover-dropdown">
                            <a class="nav-link menu-item dropdown-toggle drop-arrow-none" href="#" role="button"
                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="menu-icon"><i class="${modul.modul_icon}"></i></span>
                                <span class="menu-text">${modul.modul}</span>
                                <div class="menu-arrow"></div>
                            </a>
                            <div class="dropdown-menu">
                    `;
    
                    var menus = modul.menus;
                    for (var j = 0; j < menus.length; j++) {
                        var menu = menus[j];
    
                        if (menu.tipe === 'dropdown' && menu.sub_menus.length > 0) {
                            elemenHTML += `
                                <div class="dropdown hover-dropdown">
                                    <a class="dropdown-item dropdown-toggle drop-arrow-none" href="#"
                                        role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="${menu.menu_icon}"></i>&ensp;${menu.menu}
                                        <div class="menu-arrow"></div>
                                    </a>
                                    <div class="dropdown-menu custom-dropdown-submenu">
                            `;
    
                            var sub_menus = menu.sub_menus;
                            for (var k = 0; k < sub_menus.length; k++) {
                                var sub_menu = sub_menus[k];
    
                                elemenHTML += `
                                    <a href="#" class="dropdown-item custom-dropdown">
                                        <i class="${sub_menu.sub_menu_icon}"></i> ${sub_menu.sub_menu}
                                    </a>
                                `;
                            }
    
                            elemenHTML += `</div></div>`; // Tutup submenu dropdown
                        } else {
                            elemenHTML += `
                            <a href="#" class="dropdown-item custom-dropdown">
                                <i class="${menu.menu_icon}"></i> ${menu.menu}
                            </a>
                            `;
                        }
                    }
    
                    elemenHTML += `</div></li>`; // Tutup modul dan menu
                }
    
                elemenHTML += `</ul></div></nav>`; // Tutup navbar
    
                $('#tampil_modul').html(elemenHTML);
            }
        });
    }
    
    tampil_modul();
        </script>
        <!-- menampilkan modul -->

    <!-- Vendor js -->
    <script src="{% static 'adminto/assets/js/vendor.min.js' %}"></script>

    <!-- App js -->
    <script src="{% static 'adminto/assets/js/app.js' %}"></script>

    <!-- Apex Chart js -->
    <script src="{% static 'adminto/assets/vendor/apexcharts/apexcharts.min.js' %}"></script>

    <!-- Projects Analytics Dashboard App js -->
    <script src="{% static 'adminto/assets/js/pages/dashboard.js' %}"></script>

</body>

</html>